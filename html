public barChartOptions: any = {
  scaleShowVerticalLines: false,
  responsive: true
};
public barChartLabels: string[] = this.generateChartLabels();
public barChartType: Chart.ChartType = 'bar';
public barChartLegend = true;
public barChartData:any[] = [
  { data: [23,56,78,55], label: 'Open' },
  
  { data: [23, 56, 78, 55], label: 'Completed' },
  
]

chartdata: any;
month: any[] = [];
completedValue: any[] = [];
noncompletedValue: any[] = [];
Getbarchart() {
  const apiUrls = this.apiurl + '/Barchart/Getbarchart';
  

  const httpOptions = {
    headers: new HttpHeaders({
      'content-Type': 'application/json'
    })
  };

  this.http.get(apiUrls).subscribe(
    (response: any) => {
      this.chartdata = response;
     
      this.completedValue = response.map((item: { completedIdnum: any; }) => item.completedIdnum);
      this.noncompletedValue = response.map((item: { nonCompletedIdnum: any; }) => item.nonCompletedIdnum);
      this.month = response.map((item: { crmonth: any; }) => item.crmonth);
     
        // Remove duplicates from months
        this.months = this.months.filter((month, index, self) =>
          index === self.findIndex((m) => (
            m === month
          ))
        );

        // Limit to last 6 months
        this.months = this.months.slice(Math.max(this.months.length - 6, 0));

        // Sort months in ascending order
        this.months.sort((a, b) => new Date(a).getTime() - new Date(b).getTime());

        // Now you have the necessary data, you can create the chart
        this.createChart();
      },
    (error) => {
      console.error("Post failed", error);
    }
  );
}
createChart() {
    // Prepare data for the chart
    const chartData = {
      labels: this.months.map(month => new Date(month).toLocaleString('default', { month: 'short' })), // Use month names
      datasets: [
        {
          label: 'Completed',
          backgroundColor: 'green',
          data: this.completedValue.slice(Math.max(this.completedValue.length - 6, 0))
        },
        {
          label: 'Non-Completed',
          backgroundColor: 'red',
          data: this.noncompletedValue.slice(Math.max(this.noncompletedValue.length - 6, 0))
        }
      ]
    };

    // Now you can use a chart library like Chart.js to create the chart
    // For example, using Chart.js
    // Replace the following lines with your chart creation logic
    console.log("Chart Data:", chartData);
  }


  barChartLabels: string[] = [];
  useShortMonthNames: boolean = false;
toggleMonthNames() {
    this.useShortMonthNames = !this.useShortMonthNames;
    this.updateBarChartLabels();
  }

  updateBarChartLabels() {
    const currentDate = new Date();
    const currentMonth = currentDate.getMonth() + 1;
    const currentYear = currentDate.getFullYear();

    const monthNames = this.useShortMonthNames ? 
      ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"] :
      ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

    this.barChartLabels = Array.from({ length: 6 }, (_, i) => {
      let month = currentMonth - i;
      let year = currentYear;

      if (month <= 0) {
        month += 12;
        year--;
      }

      return monthNames[month - 1] + ' ' + year;
    }).reverse();
  }
