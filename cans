plant: any;
approval: any[] = [];
closure: any[] = [];
implementation: any[] = [];
initiated: any[] = [];
Release: any[] = [];
Gettablechart() {
  const apiUrls = this.apiurl + '/ViewChangeRequest/ViewChangerequest';

  const httpOptions = {
    headers: new HttpHeaders({
      'content-Type': 'application/json'
    })
  };

  this.http.get(apiUrls).subscribe(
    (response: any) => {
      this.chartdata = response;
      this.approval = response.filter((item: { stage: string; }) => item.stage.trim() === 'Approval').length;
      this.closure = response.filter((item: { stage: string; }) => item.stage.trim() === 'Closure').length;
      this.implementation = response.filter((item: { stage: string; }) => item.stage.trim() === 'Implementation').length;
      this.initiated = response.filter((item: { stage: string; }) => item.stage.trim() === 'Initiated').length;
      this.Release = response.filter((item: { stage: string; }) => item.stage.trim() === 'Release').length;
      this.plant = response.map((item: { plantId: any }) => item.plantId);


      // Create multi array
      this.multi = this.plant.map((plantId: any) => {
        const name = plantId.split(' ')[0];
        return {
          name: name,
          series: [
            { name: 'Approval', value: this.approval },
            { name: 'Closure', value: this.closure },
            { name: 'Implementation', value: this.implementation },
            { name: 'Initiated', value: this.initiated },
            { name: 'Release', value: this.Release }
          ]
        };

      });


      // Merge with existing data in this.multi
      this.multi.forEach((item, index) => {
        const existingItemIndex = this.multi.findIndex((el) => el.name === item.name);
        if (existingItemIndex !== -1) {
          this.multi[existingItemIndex] = { ...item, series: this.multi[existingItemIndex].series };
        } else {
          this.multi.push({
            name: item.name,
            series: [
              { name: 'Approval', value: this.approval },
              { name: 'Closure', value: this.closure },
              { name: 'Implementation', value: this.implementation },
              { name: 'Initiated', value: this.initiated },
              { name: 'Release', value: this.Release }]
          });
        }
      });

      console.log('multi:', this.multi);
    },
    (error) => {
      console.log("Post failed", error);
    }
  );
}
